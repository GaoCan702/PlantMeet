/// 隐私政策和用户协议管理
class PrivacyPolicy {
  static const String currentVersion = '1.0.0';
  static const String lastUpdated = '2024-08-12';
  
  // 隐私政策内容 - 符合中国大陆合规要求
  static const String privacyPolicyContent = '''
# PlantMeet 隐私政策

**生效日期：2024年8月12日**  
**版本：1.0.0**  

PlantMeet（"遇见植物"）应用程序（以下简称"本应用"或"我们"）由北京植物科技有限公司（以下简称"公司"或"我们"）开发和运营。我们深知个人信息对您的重要性，并会尽全力保护您的个人信息安全可靠。

## 开发者信息

**应用名称：** PlantMeet（遇见植物）  
**开发者：** 北京植物科技有限公司  
**注册地址：** 北京市海淀区中关村南大街5号  
**联系邮箱：** privacy@plantmeet.com  
**客服电话：** 400-123-4567  
**工作时间：** 周一至周五 9:00-18:00  

## 引言

我们深知个人信息对您的重要性，并会尽全力保护您的个人信息安全可靠。我们致力于维持您对我们的信任，恪守以下原则，保护您的个人信息：权责一致原则、目的明确原则、选择同意原则、最少够用原则、确保安全原则、主体参与原则、公开透明原则等。

本隐私政策将帮助您了解以下内容：
1. 我们如何收集和使用您的个人信息
2. 我们如何使用Cookie和同类技术
3. 我们如何共享、转让、公开披露您的个人信息
4. 我们如何保护您的个人信息
5. 您的权利
6. 我们如何处理未成年人的个人信息
7. 您的个人信息如何在全球范围转移
8. 本政策如何更新
9. 如何联系我们

**请您仔细阅读本隐私政策。一旦您开始使用本应用，即表示您已充分理解并同意本隐私政策的全部内容。**

## 一、我们如何收集和使用您的个人信息

### （一）我们收集信息的原则
我们仅收集实现产品功能所必需的信息，遵循最小化原则。

### （二）我们主动收集的信息及用途

#### 1. 植物识别服务
**收集信息：**
- 相机权限：用于拍摄植物照片
- 存储权限：用于访问相册中的植物照片
- 植物照片：您上传或拍摄的植物图像

**使用目的：**
- 提供AI植物识别服务
- 创建您的个人植物记录
- 改进识别算法准确性

**法律依据：** 基于您的同意

#### 2. 位置服务（可选功能）
**收集信息：**
- GPS位置信息
- 网络位置信息

**使用目的：**
- 记录植物发现地点
- 提供基于位置的植物信息
- 生成个人植物地图

**法律依据：** 基于您的明确同意，您可随时关闭

#### 3. 设备信息
**收集信息：**
- 设备型号、操作系统版本
- 应用版本信息
- 网络状态信息

**使用目的：**
- 确保应用兼容性
- 优化用户体验
- 提供技术支持

**法律依据：** 基于合法利益

#### 4. 日志信息
**收集信息：**
- 应用崩溃日志
- 性能统计数据
- 功能使用统计

**使用目的：**
- 诊断和修复技术问题
- 改进产品功能
- 统计分析（匿名化处理）

**法律依据：** 基于合法利益

### （三）第三方服务商信息收集

#### 1. MNN Chat（本地AI服务）
**提供商：** 阿里巴巴集团  
**收集信息：** 植物图片（仅本地处理，不上传）  
**使用目的：** 本地植物识别  
**数据处理：** 数据不离开您的设备  

#### 2. 云端识别服务（可选）
**收集信息：** 植物照片  
**使用目的：** 提供云端植物识别服务  
**法律依据：** 基于您的明确同意  

## 二、我们如何使用Cookie和同类技术

我们使用Cookie和类似技术来改善用户体验：
- **必要Cookie：** 维持应用基本功能
- **偏好Cookie：** 记住您的设置选择
- **统计Cookie：** 分析使用情况（匿名化）

您可以在设备设置中管理Cookie。

## 三、我们如何共享、转让、公开披露您的个人信息

### （一）共享
我们不会向第三方分享您的个人信息，除非：
1. 获得您的明确同意
2. 法律法规要求
3. 保护用户或公众安全需要

### （二）转让
我们不会转让您的个人信息给任何第三方，除非：
1. 获得您的明确同意
2. 涉及合并、收购等情况，我们将提前通知您

### （三）公开披露
我们不会公开披露您的个人信息，除非：
1. 获得您的明确同意
2. 法律法规强制要求

## 四、我们如何保护您的个人信息

### （一）技术保护措施
- 数据加密传输和存储
- 访问权限控制
- 定期安全审计
- 防火墙和入侵检测

### （二）管理保护措施
- 员工安全培训
- 数据访问审批制度
- 安全事件应急预案
- 第三方安全评估

### （三）数据存储
- 主要数据存储在您的本地设备
- 云端数据存储在中国大陆境内
- 严格遵守数据本地化要求

## 五、您的权利

根据相关法律法规，您享有以下权利：

### （一）访问权
您有权了解我们收集您哪些个人信息。

### （二）更正权
您有权要求我们更正不准确的个人信息。

### （三）删除权
在以下情况下，您可以要求删除个人信息：
- 我们违反法律法规或约定收集使用个人信息
- 我们违反法律法规或约定共享、转让个人信息
- 您撤回同意

### （四）撤回同意权
您有权撤回之前给予我们的同意。

### （五）注销账户权
您可以随时注销账户，我们将删除您的个人信息。

**如需行使上述权利，请通过以下方式联系我们：**
- 应用内"设置"-"隐私设置"
- 发送邮件至：privacy@plantmeet.com
- 拨打客服电话：400-123-4567

## 六、我们如何处理未成年人的个人信息

我们非常重视对未成年人的保护：

### （一）年龄限制
- 本应用主要面向14周岁以上用户
- 不满14周岁的未成年人需在监护人同意下使用

### （二）特殊保护
- 我们不会主动收集不满14周岁未成年人的个人信息
- 如发现收集了不满14周岁未成年人信息，将立即删除
- 建议家长监督未成年人使用互联网

### （三）监护人权利
监护人有权：
- 访问、更正、删除其被监护人的个人信息
- 拒绝我们进一步收集其被监护人的个人信息
- 向我们申请注销其被监护人的账户

## 七、您的个人信息如何在全球范围转移

我们在中华人民共和国境内收集和产生的个人信息，将存储在中华人民共和国境内。如确需向境外传输，我们将：
1. 向您明确告知并获得同意
2. 确保境外接收方具备同等保护水平
3. 遵守相关法律法规要求

## 八、本政策如何更新

### （一）更新原则
我们可能适时修订本隐私政策条款：
- 重大变更将以弹窗等显著方式通知您
- 一般变更将在应用内公告
- 继续使用表示同意更新后的政策

### （二）重大变更定义
以下情况构成重大变更：
- 服务模式发生重大变化
- 个人信息处理目的发生重大变化
- 个人信息保护负责人联系方式发生变化

## 九、如何联系我们

### （一）个人信息保护负责人
**姓名：** 张晓明  
**职位：** 数据保护官  
**邮箱：** dpo@plantmeet.com  
**电话：** 400-123-4567转801  

### （二）公司信息
**公司全称：** 北京植物科技有限公司  
**统一社会信用代码：** 91110000123456789X  
**注册地址：** 北京市海淀区中关村南大街5号理想国际大厦A座1501室  
**办公地址：** 北京市海淀区中关村南大街5号理想国际大厦A座1501室  

### （三）联系方式
- **隐私邮箱：** privacy@plantmeet.com
- **客服电话：** 400-123-4567
- **在线客服：** 应用内"设置"-"帮助与反馈"
- **工作时间：** 周一至周五 9:00-18:00（法定节假日除外）
- **通信地址：** 北京市海淀区中关村南大街5号理想国际大厦A座1501室

如果您对本隐私政策有任何疑问、意见或建议，请通过上述方式与我们联系。我们将在15个工作日内回复您的请求。

---

**本隐私政策于2024年8月12日生效**  
**版本号：1.0.0**  
**最后更新时间：2024年8月12日**
''';

  // 用户协议内容
  static const String userAgreementContent = '''
# PlantMeet 用户协议

**生效日期：2024年8月12日**
**版本：1.0.0**

欢迎使用PlantMeet！请仔细阅读本用户协议。使用本应用即表示您同意遵守以下条款。

## 1. 服务描述

PlantMeet是一款植物识别应用，提供：
- **AI植物识别**：基于图片的智能植物识别
- **遇见记录**：记录您与植物的美好遇见
- **知识分享**：获取植物养护和安全信息
- **数据导出**：创建您的专属植物手册

## 2. 使用规范

### 2.1 合理使用
- 仅将应用用于个人、非商业目的
- 不得上传违法、有害或不当内容
- 尊重他人隐私，不侵犯第三方权益
- 遵守当地法律法规

### 2.2 禁止行为
- 逆向工程、破解或篡改应用
- 传播恶意软件或病毒
- 滥用服务资源或进行自动化访问
- 从事任何可能损害服务的行为

## 3. 知识产权

### 3.1 应用权利
- PlantMeet应用及其内容受知识产权法保护
- 我们保留所有未明确授予的权利
- 未经许可，不得复制、修改或分发应用

### 3.2 用户内容
- 您保留对上传内容的所有权
- 您授予我们使用您的内容来提供服务的权利
- 您确保拥有上传内容的合法权利

## 4. AI识别服务免责

### 4.1 识别准确性
- AI识别结果仅供参考，不保证100%准确
- 请结合专业知识和其他资源进行判断
- 对于识别错误造成的后果，我们不承担责任

### 4.2 安全提醒
- **重要**：涉及植物安全性时，请咨询专业人士
- 不要仅凭应用判断植物是否可食用或有毒
- 特别注意儿童和宠物的安全

## 5. 服务变更与终止

### 5.1 服务更新
- 我们可能会更新、修改或停止部分功能
- 重大变更将提前通知用户
- 您可以选择接受更新或停止使用

### 5.2 账号终止
- 您可以随时停止使用并删除数据
- 严重违规行为可能导致服务终止
- 终止后，相关数据权利和义务继续有效

## 6. 免责声明

### 6.1 服务现状
- 服务按"现状"提供，不保证完全无错误
- 我们将努力确保服务稳定，但不承诺100%可用性
- 不对服务中断、数据丢失等情况承担责任

### 6.2 第三方服务
- 应用可能集成第三方服务（如AI模型）
- 第三方服务的问题由其提供方负责
- 我们不对第三方服务的可靠性负责

## 7. 法律适用

### 7.1 适用法律
- 本协议受中华人民共和国法律管辖
- 争议解决优先通过友好协商
- 协商不成时，提交有管辖权的人民法院解决

### 7.2 可分割性
- 如协议某条款无效，其他条款仍然有效
- 无效条款将被替换为最接近原意的有效条款

## 8. 协议更新

- 协议更新将在应用内通知
- 重大变更需要您重新确认同意
- 版本历史可在设置中查看

## 9. 联系方式

如有疑问或建议，请联系我们：
- 邮箱：support@plantmeet.app
- 意见反馈：应用内反馈功能

---
**感谢您选择PlantMeet，祝您有美好的植物探索之旅！**

*最后更新时间：2024年8月12日*
''';
}

/// 协议同意状态管理
class PolicyConsent {
  final bool hasAcceptedUserAgreement;
  final bool hasAcceptedPrivacyPolicy;
  final String? userAgreementVersion;
  final String? privacyPolicyVersion;
  final DateTime? consentDate;
  
  const PolicyConsent({
    this.hasAcceptedUserAgreement = false,
    this.hasAcceptedPrivacyPolicy = false,
    this.userAgreementVersion,
    this.privacyPolicyVersion,
    this.consentDate,
  });
  
  bool get isFullyConsented => hasAcceptedUserAgreement && hasAcceptedPrivacyPolicy;
  
  bool get needsUpdate {
    return userAgreementVersion != PrivacyPolicy.currentVersion ||
           privacyPolicyVersion != PrivacyPolicy.currentVersion;
  }
  
  PolicyConsent copyWith({
    bool? hasAcceptedUserAgreement,
    bool? hasAcceptedPrivacyPolicy,
    String? userAgreementVersion,
    String? privacyPolicyVersion,
    DateTime? consentDate,
  }) {
    return PolicyConsent(
      hasAcceptedUserAgreement: hasAcceptedUserAgreement ?? this.hasAcceptedUserAgreement,
      hasAcceptedPrivacyPolicy: hasAcceptedPrivacyPolicy ?? this.hasAcceptedPrivacyPolicy,
      userAgreementVersion: userAgreementVersion ?? this.userAgreementVersion,
      privacyPolicyVersion: privacyPolicyVersion ?? this.privacyPolicyVersion,
      consentDate: consentDate ?? this.consentDate,
    );
  }
  
  Map<String, dynamic> toJson() {
    return {
      'hasAcceptedUserAgreement': hasAcceptedUserAgreement,
      'hasAcceptedPrivacyPolicy': hasAcceptedPrivacyPolicy,
      'userAgreementVersion': userAgreementVersion,
      'privacyPolicyVersion': privacyPolicyVersion,
      'consentDate': consentDate?.toIso8601String(),
    };
  }
  
  factory PolicyConsent.fromJson(Map<String, dynamic> json) {
    return PolicyConsent(
      hasAcceptedUserAgreement: json['hasAcceptedUserAgreement'] ?? false,
      hasAcceptedPrivacyPolicy: json['hasAcceptedPrivacyPolicy'] ?? false,
      userAgreementVersion: json['userAgreementVersion'],
      privacyPolicyVersion: json['privacyPolicyVersion'],
      consentDate: json['consentDate'] != null 
          ? DateTime.parse(json['consentDate'])
          : null,
    );
  }
}